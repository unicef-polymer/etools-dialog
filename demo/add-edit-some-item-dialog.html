<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../etools-dialog.html">
<link rel="import" href="../../etools-loading/etools-loading.html">

<dom-module id="add-edit-some-item-dialog">
  <template>
    <style>
      [hidden] {
        display: none !important;
      }
      #divErroMsg {
        padding: 10px;
        border: solid 1px red;
        background-color: pink
      }
     </style>
    <div>
    <etools-dialog id="saveDialog"
      keep-dialog-open
      confirm-btn-clicked-callback="[[saveBtnClickedCallback]]"
      size="md" opened="[[opened]]" dialog-title="Some title"
      on-close="onClose" ok-btn-text="Save">
       <div id="divErroMsg" hidden$="[[!showError]]">
         There was an error saving data ...
       </div>
        <h3>Some subtitle</h3>
        <p>Some paragraph</p>
        Form content goes here...
    </etools-dialog>
    </div>
  </template>

  <script>
    (function() {
      // jscs:disable
      'use strict';

      Polymer({
        is: 'add-edit-some-item-dialog',
        properties: {
          saveBtnClickedCallback: {
            type: Object
          },
          showError: {
            type: Boolean,
            value: false
          },
          successfulApiCall: {
            type : Boolean,
            value: true
          }

        },
        ready: function() {
          this.saveBtnClickedCallback = this._save.bind(this);

        },
        onClose: function() {
          this.showError = false;
          this.$.saveDialog.stopSpinner();
        },
        open: function() {
          this.$.saveDialog.opened = true;
        },
        _save: function(callback) {
          var self = this;
          var url = 'https://httpbin.org/delay/2';
          if (!this.successfulApiCall) {
            url = 'https://httpbin.org/status/500';
          }
          self.$.saveDialog.startSpinner();
          fetch(url).then(function(resp) {
            self.$.saveDialog.stopSpinner();
            if (resp.ok) {
              self.$.saveDialog.opened = false;
            } else {
              self.showError = true;
            }
          })
        }
      });

    })();
  </script>
</dom-module>



